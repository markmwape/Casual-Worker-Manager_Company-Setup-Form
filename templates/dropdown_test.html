<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Switcher Dropdown Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/language-switcher.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/language-switcher-fixes.css') }}">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
        .test-section { 
            min-height: 200px; 
            border: 2px dashed #e5e7eb; 
            position: relative; 
            overflow: visible;
        }
        .test-result { 
            padding: 1rem; 
            margin: 1rem 0; 
            border-radius: 0.5rem; 
        }
        .test-pass { background: #dcfce7; border: 1px solid #16a34a; color: #166534; }
        .test-fail { background: #fef2f2; border: 1px solid #dc2626; color: #991b1b; }
        .dark-bg { background: linear-gradient(135deg, #1f2937 0%, #111827 100%); }
        .sidebar-simulation { 
            background: linear-gradient(180deg, #1f2937 0%, #111827 100%);
            width: 280px;
            position: relative;
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold text-center mb-8 text-gray-900">
            üåç Language Switcher Dropdown Test Suite
        </h1>
        
        <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <h2 class="text-lg font-semibold text-blue-900 mb-2">üìã Test Instructions</h2>
            <p class="text-blue-800">
                Click each language switcher button below to test dropdown functionality. 
                Each should open smoothly and close others automatically.
            </p>
        </div>

        <!-- Test Results Display -->
        <div id="test-results" class="mb-8">
            <h3 class="text-xl font-semibold mb-4">üß™ Test Results</h3>
            <div id="results-container"></div>
        </div>

        <!-- Test 1: Landing Page Context -->
        <div class="mb-12">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">
                üè† Test 1: Landing Page Context (Top-Right Fixed)
            </h2>
            <div class="test-section bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg p-8 text-white">
                <div class="absolute top-4 right-4 landing-language-switcher">
                    {% include 'components/language_switcher.html' %}
                </div>
                <h3 class="text-xl font-bold mb-2">Landing Page Simulation</h3>
                <p class="text-blue-100">Fixed positioned language switcher (top-right)</p>
            </div>
        </div>

        <!-- Test 2: Sidebar Context -->
        <div class="mb-12">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">
                üì± Test 2: Sidebar Context (Dashboard Pages)
            </h2>
            <div class="test-section flex">
                <div class="sidebar-simulation p-6 text-white">
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">Dashboard Menu</h3>
                        <div class="space-y-2">
                            <div class="p-3 rounded-lg bg-white/10">Home</div>
                            <div class="p-3 rounded-lg bg-white/10">Workers</div>
                            <div class="p-3 rounded-lg bg-white/10">Tasks</div>
                            <div class="p-3 rounded-lg bg-white/10">Reports</div>
                        </div>
                    </div>
                    
                    <!-- Language Switcher in Sidebar Footer -->
                    <div class="border-t border-white/20 pt-4 sidebar-language-switcher">
                        <div class="flex justify-center mb-4">
                            {% include 'components/language_switcher.html' %}
                        </div>
                        <button class="w-full p-3 rounded-lg bg-white/10 text-left">Sign Out</button>
                    </div>
                </div>
                <div class="flex-1 p-6 bg-white">
                    <h3 class="text-xl font-bold mb-2">Main Dashboard Content</h3>
                    <p class="text-gray-600">Sidebar language switcher should work from here</p>
                </div>
            </div>
        </div>

        <!-- Test 3: Header Context -->
        <div class="mb-12">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">
                üìÑ Test 3: Header Context (Sign-in/Legal Pages)
            </h2>
            <div class="test-section bg-white border rounded-lg">
                <header class="bg-white shadow-sm border-b p-4 relative">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <h3 class="text-xl font-bold text-gray-900">Embee Accounting</h3>
                        </div>
                        <div class="header-language-switcher">
                            {% include 'components/language_switcher.html' %}
                        </div>
                    </div>
                </header>
                <div class="p-8">
                    <h3 class="text-xl font-bold mb-2">Sign-in Page Simulation</h3>
                    <p class="text-gray-600">Header-positioned language switcher</p>
                </div>
            </div>
        </div>

        <!-- Test 4: Mobile Menu Context -->
        <div class="mb-12">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">
                üì± Test 4: Mobile Menu Context
            </h2>
            <div class="test-section bg-gray-100 border rounded-lg max-w-sm mx-auto">
                <div class="bg-white shadow-lg rounded-lg overflow-hidden">
                    <div class="p-4 bg-blue-600 text-white">
                        <h3 class="font-bold">Mobile Menu</h3>
                    </div>
                    <div class="p-4 space-y-3">
                        <a href="#" class="block p-3 rounded-lg hover:bg-gray-50">Home</a>
                        <a href="#" class="block p-3 rounded-lg hover:bg-gray-50">About</a>
                        <a href="#" class="block p-3 rounded-lg hover:bg-gray-50">Contact</a>
                        <a href="#" class="block p-3 rounded-lg bg-blue-600 text-white text-center font-bold">Login</a>
                    </div>
                    <div class="border-t border-gray-200 p-4 mobile-menu-language-switcher">
                        {% include 'components/language_switcher.html' %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Test 5: Multiple Instances -->
        <div class="mb-12">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">
                üîÑ Test 5: Multiple Instances (Auto-Close Test)
            </h2>
            <div class="test-section bg-white border rounded-lg p-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="text-center p-4 border rounded-lg">
                        <h4 class="font-semibold mb-4">Instance 1</h4>
                        <div class="flex justify-center">
                            {% include 'components/language_switcher.html' %}
                        </div>
                    </div>
                    <div class="text-center p-4 border rounded-lg">
                        <h4 class="font-semibold mb-4">Instance 2</h4>
                        <div class="flex justify-center">
                            {% include 'components/language_switcher.html' %}
                        </div>
                    </div>
                    <div class="text-center p-4 border rounded-lg">
                        <h4 class="font-semibold mb-4">Instance 3</h4>
                        <div class="flex justify-center">
                            {% include 'components/language_switcher.html' %}
                        </div>
                    </div>
                </div>
                <p class="text-gray-600 text-center mt-4">
                    Opening one should close the others automatically
                </p>
            </div>
        </div>

        <!-- Test Controls -->
        <div class="bg-white p-6 rounded-lg border shadow-sm">
            <h3 class="text-xl font-semibold mb-4">üß™ Test Controls</h3>
            <div class="flex flex-wrap gap-4">
                <button onclick="runAllTests()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
                    Run All Tests
                </button>
                <button onclick="testDropdownVisibility()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition">
                    Test Visibility
                </button>
                <button onclick="testAutoClose()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition">
                    Test Auto-Close
                </button>
                <button onclick="clearResults()" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition">
                    Clear Results
                </button>
            </div>
        </div>
    </div>

    <!-- Include Language Switcher JavaScript -->
    <script src="{{ url_for('static', filename='js/language-switcher.js') }}"></script>
    
    <!-- Test JavaScript -->
    <script>
        let testResults = [];

        function addTestResult(testName, passed, message) {
            testResults.push({ testName, passed, message, timestamp: new Date() });
            updateResultsDisplay();
        }

        function updateResultsDisplay() {
            const container = document.getElementById('results-container');
            container.innerHTML = testResults.map(result => `
                <div class="test-result ${result.passed ? 'test-pass' : 'test-fail'}">
                    <strong>${result.passed ? '‚úÖ' : '‚ùå'} ${result.testName}</strong><br>
                    <span class="text-sm">${result.message}</span><br>
                    <span class="text-xs opacity-75">${result.timestamp.toLocaleTimeString()}</span>
                </div>
            `).join('');
        }

        function testDropdownVisibility() {
            const dropdowns = document.querySelectorAll('.language-switcher, .language-switcher-container');
            let visibleCount = 0;

            dropdowns.forEach((dropdown, index) => {
                const button = dropdown.querySelector('.language-switcher-btn, .dropdown-toggle');
                const menu = dropdown.querySelector('.language-menu, .dropdown-menu');

                if (button && menu) {
                    // Simulate click
                    button.click();
                    
                    // Check if visible after click
                    setTimeout(() => {
                        const isVisible = menu.classList.contains('visible') || 
                                        menu.style.display === 'block' ||
                                        button.getAttribute('aria-expanded') === 'true';
                        
                        if (isVisible) {
                            visibleCount++;
                            addTestResult(`Dropdown ${index + 1}`, true, 'Successfully opens on click');
                        } else {
                            addTestResult(`Dropdown ${index + 1}`, false, 'Failed to open on click');
                        }
                        
                        // Close it
                        button.click();
                    }, 100);
                } else {
                    addTestResult(`Dropdown ${index + 1}`, false, 'Missing button or menu element');
                }
            });
        }

        function testAutoClose() {
            const dropdowns = document.querySelectorAll('.language-switcher, .language-switcher-container');
            
            if (dropdowns.length < 2) {
                addTestResult('Auto-Close Test', false, 'Need at least 2 dropdowns to test auto-close');
                return;
            }

            // Open first dropdown
            const firstButton = dropdowns[0].querySelector('.language-switcher-btn, .dropdown-toggle');
            const firstMenu = dropdowns[0].querySelector('.language-menu, .dropdown-menu');
            
            if (firstButton && firstMenu) {
                firstButton.click();
                
                setTimeout(() => {
                    // Open second dropdown
                    const secondButton = dropdowns[1].querySelector('.language-switcher-btn, .dropdown-toggle');
                    const secondMenu = dropdowns[1].querySelector('.language-menu, .dropdown-menu');
                    
                    if (secondButton && secondMenu) {
                        secondButton.click();
                        
                        setTimeout(() => {
                            const firstStillVisible = firstMenu.classList.contains('visible') || 
                                                    firstMenu.style.display === 'block';
                            const secondVisible = secondMenu.classList.contains('visible') || 
                                                 secondMenu.style.display === 'block';
                            
                            if (!firstStillVisible && secondVisible) {
                                addTestResult('Auto-Close Test', true, 'First dropdown closed when second opened');
                            } else {
                                addTestResult('Auto-Close Test', false, 'Auto-close mechanism not working');
                            }
                            
                            // Close second dropdown
                            secondButton.click();
                        }, 100);
                    }
                }, 100);
            }
        }

        function runAllTests() {
            clearResults();
            addTestResult('Test Suite Started', true, 'Running comprehensive dropdown tests...');
            
            setTimeout(() => {
                testDropdownVisibility();
                setTimeout(() => {
                    testAutoClose();
                }, 1000);
            }, 500);
        }

        function clearResults() {
            testResults = [];
            updateResultsDisplay();
        }

        // Auto-run basic test on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                addTestResult('Page Load', true, 'Language switcher test page loaded successfully');
                
                const dropdownCount = document.querySelectorAll('.language-switcher, .language-switcher-container').length;
                addTestResult('Component Count', dropdownCount > 0, `Found ${dropdownCount} language switcher instances`);
            }, 1000);
        });
    </script>
</body>
</html>
