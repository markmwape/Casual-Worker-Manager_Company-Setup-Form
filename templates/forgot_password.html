<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password</title>
    <link rel="stylesheet" href="/static/css/signin.css">
</head>
<body>
    <div class="container">
        <h1>Reset Password</h1>
        <form id="reset-form">
            <input type="email" name="email" id="email" placeholder="Enter your email" required>
            <button type="submit">Send Reset Link</button>
            <div id="reset-error"></div>
        </form>
        <a href="/signin">Back to Sign In</a>
    </div>

    <!-- Password reset form handling with Firebase Auth -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';

        async function initReset() {
            // Initialize Firebase
            try {
                const response = await fetch('/firebase_config');
                const firebaseConfig = await response.json();
                if (!firebaseConfig.apiKey) {
                    // fallback config
                    firebaseConfig.apiKey = "AIzaSyD9_N_0ve9ABFwwnTBn1N2oxlUs6xbT-No";
                    firebaseConfig.authDomain = "ember-accounting.firebaseapp.com";
                    firebaseConfig.projectId = "ember-accounting";
                    firebaseConfig.storageBucket = "ember-accounting.firebasestorage.app";
                    firebaseConfig.messagingSenderId = "328324461979";
                    firebaseConfig.appId = "1:3289ddad6aa3f157359d3e";
                    firebaseConfig.measurementId = "G-F1XTE0TP63";
                }
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);

                const form = document.getElementById('reset-form');
                form.addEventListener('submit', async event => {
                    event.preventDefault();
                    const email = document.getElementById('email').value;
                    const errorElement = document.getElementById('reset-error');
                    errorElement.textContent = '';
                    try {
                        await sendPasswordResetEmail(auth, email);
                        errorElement.style.color = 'green';
                        errorElement.textContent = 'Password reset email sent. Check your inbox.';
                    } catch (err) {
                        errorElement.style.color = 'red';
                        errorElement.textContent = err.message;
                    }
                });
            } catch (err) {
                console.error('Firebase init error:', err);
                const errorElement = document.getElementById('reset-error');
                if (errorElement) {
                    errorElement.style.color = 'red';
                    errorElement.textContent = 'Configuration error. Please contact support.';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', initReset);
    </script>
</body>
</html>