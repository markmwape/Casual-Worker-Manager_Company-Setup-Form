<div id="add-task-modal" class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg mb-4">Create New Task</h3>
        
        <div id="task-date-error" class="alert alert-error mb-4" style="display:none;">
            <span class="error-text"></span>
        </div>
        
        <form id="addTaskForm" method="POST" action="/tasks">
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-semibold">Task Name *</span>
                </label>
                <input type="text" name="name" placeholder="Enter task name" class="input input-bordered w-full" required />
            </div>

            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-semibold">Description</span>
                </label>
                <textarea name="description" placeholder="Task description (optional)" class="textarea textarea-bordered w-full" rows="3"></textarea>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Start Date</span>
                    </label>
                    <input type="date" name="start_date" class="input input-bordered w-full" />
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Deadline</span>
                    </label>
                    <input type="date" name="deadline" class="input input-bordered w-full" />
                </div>
            </div>

            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-semibold">Expected Workers</span>
                </label>
                <input type="text" name="expected_workers" placeholder="e.g., 5 or 5-10" class="input input-bordered w-full" />
            </div>

            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-semibold">Payment Type *</span>
                </label>
                <div class="flex gap-4 flex-wrap">
                    <label class="cursor-pointer flex items-center gap-2 p-3 border rounded-lg">
                        <input type="radio" name="payment_type" value="hourly" class="radio radio-primary" required />
                        <span>Hourly Rate</span>
                    </label>
                    <label class="cursor-pointer flex items-center gap-2 p-3 border rounded-lg">
                        <input type="radio" name="payment_type" value="fixed" class="radio radio-primary" required />
                        <span>Fixed Amount</span>
                    </label>
                    <label class="cursor-pointer flex items-center gap-2 p-3 border rounded-lg">
                        <input type="radio" name="payment_type" value="piece_rate" class="radio radio-primary" required />
                        <span>Piece Rate</span>
                    </label>
                </div>
            </div>

            <!-- Fixed Payment Fields -->
            <div id="payout-fields" style="display:none;">
                <div class="form-control mb-4">
                    <label class="label">
                        <span class="label-text font-semibold">Fixed Payout Amount *</span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="number" step="0.01" min="0.01" name="payout" id="payout" placeholder="Amount" class="input input-bordered w-full" />
                        <select name="currency" id="currency" class="select select-bordered w-full">
                            <option value="">Select Currency</option>
                            <option value="USD">USD - US Dollar ($)</option>
                            <option value="EUR">EUR - Euro (€)</option>
                            <option value="GBP">GBP - British Pound (£)</option>
                            <option value="ZAR">ZAR - South African Rand (R)</option>
                            <option value="ZMW">ZMW - Zambian Kwacha (K)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Piece Rate Fields -->
            <div id="per-part-payout-group" style="display:none;">
                <div class="form-control mb-4">
                    <label class="label">
                        <span class="label-text font-semibold">Payout per Part *</span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="number" step="0.01" min="0.01" name="per_part_payout" id="per-part-payout" placeholder="Amount per part" class="input input-bordered w-full" />
                        <select name="per_part_currency" id="per-part-currency" class="select select-bordered w-full">
                            <option value="">Select Currency</option>
                            <option value="USD">USD - US Dollar ($)</option>
                            <option value="EUR">EUR - Euro (€)</option>
                            <option value="GBP">GBP - British Pound (£)</option>
                            <option value="ZAR">ZAR - South African Rand (R)</option>
                            <option value="ZMW">ZMW - Zambian Kwacha (K)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="modal-action">
                <button type="button" class="btn btn-ghost" onclick="closeAddTaskModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Task</button>
            </div>
        </form>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button onclick="closeAddTaskModal()">close</button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const paymentTypeRadios = document.querySelectorAll('input[name="payment_type"]');
    const payoutFields = document.getElementById('payout-fields');
    const perPartPayoutGroup = document.getElementById('per-part-payout-group');
    
    function updatePayoutDisplay() {
        const selectedType = document.querySelector('input[name="payment_type"]:checked');
        if (selectedType) {
            if (selectedType.value === 'fixed') {
                payoutFields.style.display = 'block';
                perPartPayoutGroup.style.display = 'none';
            } else if (selectedType.value === 'piece_rate') {
                payoutFields.style.display = 'none';
                perPartPayoutGroup.style.display = 'block';
            } else {
                payoutFields.style.display = 'none';
                perPartPayoutGroup.style.display = 'none';
            }
        }
    }
    
    paymentTypeRadios.forEach(radio => {
        radio.addEventListener('change', updatePayoutDisplay);
    });
    
    updatePayoutDisplay();
});

function closeAddTaskModal() {
    const modal = document.getElementById('add-task-modal');
    const form = document.getElementById('addTaskForm');
    
    if (form) {
        form.reset();
        const payoutFields = document.getElementById('payout-fields');
        const perPartPayoutGroup = document.getElementById('per-part-payout-group');
        if (payoutFields) payoutFields.style.display = 'none';
        if (perPartPayoutGroup) perPartPayoutGroup.style.display = 'none';
    }
    
    if (modal) {
        modal.close();
    }
}
</script>
