<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workspace Selection - Embee Accounting</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.24/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.tailwind = window.tailwind || {};
        window.tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-navy': {
                            '50': '#f8fafc',
                            '100': '#e2e8f0',
                            '200': '#cbd5e1',
                            '300': '#94a3b8',
                            '400': '#64748b',
                            '500': '#1A2B48',
                            '600': '#0f1a2e',
                            '700': '#0a1424',
                            '800': '#050a12',
                            '900': '#020508'
                        },
                        'brand-gold': {
                            '50': '#fefce8',
                            '100': '#fef3c7',
                            '200': '#fde68a',
                            '300': '#fcd34d',
                            '400': '#fbbf24',
                            '500': '#E5B23A',
                            '600': '#d4a02a',
                            '700': '#b45309',
                            '800': '#92400e',
                            '900': '#78350f'
                        },
                        'brand-gray': {
                            '50': '#f8fafc',
                            '100': '#f1f5f9',
                            '200': '#e2e8f0',
                            '300': '#cbd5e1',
                            '400': '#94a3b8',
                            '500': '#7C8A9A',
                            '600': '#5a6778',
                            '700': '#475569',
                            '800': '#334155',
                            '900': '#1e293b'
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1A2B48 0%, #2a3f5f 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .icon-glow {
            box-shadow: 0 0 20px rgba(26, 43, 72, 0.3);
        }
        .input-focus {
            transition: all 0.3s ease;
        }
        .input-focus:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(26, 43, 72, 0.1);
        }
        .btn-hover {
            transition: all 0.3s ease;
        }
        .btn-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .shadow-3xl {
            box-shadow: 0 35px 60px -15px rgba(0, 0, 0, 0.3);
        }
        .honeycomb-corner {
            position: absolute;
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, rgba(26, 43, 72, 0.1) 0%, rgba(124, 138, 154, 0.05) 100%);
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
            pointer-events: none;
            z-index: 1;
        }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1A2B48;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .success-checkmark {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #7bb026;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen relative py-8">
    <!-- Honeycomb Pattern Corners -->
    <div class="honeycomb-corner" style="top:5%;left:5%;transform:rotate(60deg);opacity:0.3;"></div>
    <div class="honeycomb-corner" style="bottom:10%;right:5%;transform:rotate(-45deg);opacity:0.4;"></div>
    <div class="honeycomb-corner" style="top:20%;right:10%;transform:rotate(15deg);opacity:0.2;"></div>
    <div class="honeycomb-corner" style="bottom:30%;left:8%;transform:rotate(-30deg);opacity:0.3;"></div>
    <div class="honeycomb-corner" style="top:60%;left:15%;transform:rotate(45deg);opacity:0.25;"></div>
    
    <div class="w-full max-w-6xl mx-auto relative z-10 px-4">
        <!-- Header Section -->
        <div class="text-center mb-12">
            <div class="inline-flex items-center justify-center mb-6">
                <img src="{{ url_for('static', filename='img/logo + text.png') }}" alt="Embee Accounting Logo" class="h-24 w-auto object-contain floating-animation" />
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-brand-navy-600 mb-4">Welcome to Your Workspace</h1>
            <p class="text-xl text-brand-gray-600 max-w-2xl mx-auto">Choose how you'd like to get started with your professional workforce management platform</p>
        </div>
        
        <!-- Global Success/Error Messages -->
        <div id="global-success" class="alert alert-success shadow-lg mb-6 hidden">
            <div>
                <svg class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span id="global-success-message"></span>
            </div>
        </div>
        <div id="global-error" class="alert alert-error shadow-lg mb-6 hidden">
            <div>
                <svg class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span id="global-error-message"></span>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            <!-- Join Workspace Card -->
            <div class="card bg-white/80 backdrop-blur-sm shadow-2xl border-0 card-hover border border-emerald-200/30 hover:shadow-3xl">
                <div class="card-body p-8 md:p-10">
                    <div class="flex flex-col items-center text-center">
                        <div class="w-20 h-20 bg-gradient-to-br from-emerald-500 to-green-600 rounded-2xl flex items-center justify-center mb-6 shadow-xl icon-glow">
                            <i class="fas fa-users text-3xl text-white"></i>
                        </div>
                        <h2 class="card-title text-3xl font-bold text-brand-navy-600 mb-3">Join a Workspace</h2>
                        <p class="text-brand-gray-600 mb-8 text-lg">Enter your workspace code to join an existing team</p>
                        <form id="join-workspace-form" class="w-full space-y-6">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-semibold text-brand-navy-600 text-lg">Workspace Code</span>
                                </label>
                                <input type="text" id="workspace-code" name="workspace_code" placeholder="Enter 16-character code" required 
                                       class="input input-bordered w-full text-lg font-mono tracking-wider input-focus bg-white border-2 border-emerald-200 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200" 
                                       maxlength="16" pattern="[A-Z0-9]{16}" style="text-transform: uppercase;">
                                <label class="label">
                                    <span class="label-text-alt text-brand-gray-500">Enter the 16-character workspace code provided by your administrator</span>
                                </label>
                            </div>
                            <button type="submit" id="join-btn" class="btn btn-success w-full text-lg font-semibold btn-hover bg-gradient-to-r from-emerald-500 to-green-600 border-0 shadow-lg">
                                <span id="join-btn-text">
                                    <i class="fas fa-sign-in-alt mr-3"></i>Join Workspace
                                </span>
                                <span id="join-btn-loading" class="hidden">
                                    <div class="loading-spinner inline-block mr-3"></div>Joining...
                                </span>
                            </button>
                        </form>
                        <div id="join-error" class="text-error text-center mt-4 hidden"></div>
                        <!-- Forgot workspace link -->
                        <div class="text-center mt-6">
                            <a href="/forgot-workspace" class="text-emerald-600 hover:text-emerald-700 text-sm font-medium transition-colors">
                                <i class="fas fa-question-circle mr-1"></i>Forgot your workspace code?
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Create Workspace Card -->
            <div class="card bg-white/80 backdrop-blur-sm shadow-2xl border-0 card-hover border border-blue-200/30 hover:shadow-3xl">
                <div class="card-body p-8 md:p-10">
                    <div class="flex flex-col items-center text-center">
                        <div class="w-20 h-20 bg-gradient-to-br from-brand-navy-500 to-brand-navy-600 rounded-2xl flex items-center justify-center mb-6 shadow-xl icon-glow">
                            <i class="fas fa-building text-3xl text-white"></i>
                        </div>
                        <h2 class="card-title text-3xl font-bold text-brand-navy-600 mb-3">Create a Workspace</h2>
                        <p class="text-brand-gray-600 mb-8 text-lg">Set up a new workspace for your organization</p>
                        <form id="create-workspace-form" class="w-full space-y-6">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-semibold text-brand-navy-600 text-lg">Company Name</span>
                                </label>
                                <input type="text" id="company-name" name="company_name" placeholder="Enter company name" required 
                                       class="input input-bordered w-full text-lg input-focus bg-white border-2 border-blue-200 focus:border-brand-navy-500 focus:ring-2 focus:ring-blue-200"
                                       minlength="2" maxlength="100">
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-semibold text-brand-navy-600 text-lg">Country</span>
                                </label>
                                <select id="country" name="country" required class="select select-bordered w-full text-lg input-focus bg-white border-2 border-blue-200 focus:border-brand-navy-500 focus:ring-2 focus:ring-blue-200">
                                    <option value="">Select country</option>
                                    <option value="United States">United States</option>
                                    <option value="United Kingdom">United Kingdom</option>
                                    <option value="Canada">Canada</option>
                                    <option value="Australia">Australia</option>
                                    <option value="Germany">Germany</option>
                                    <option value="France">France</option>
                                    <option value="Spain">Spain</option>
                                    <option value="Italy">Italy</option>
                                    <option value="Netherlands">Netherlands</option>
                                    <option value="Belgium">Belgium</option>
                                    <option value="Switzerland">Switzerland</option>
                                    <option value="Austria">Austria</option>
                                    <option value="Sweden">Sweden</option>
                                    <option value="Norway">Norway</option>
                                    <option value="Denmark">Denmark</option>
                                    <option value="Finland">Finland</option>
                                    <option value="Ireland">Ireland</option>
                                    <option value="Portugal">Portugal</option>
                                    <option value="Poland">Poland</option>
                                    <option value="Czech Republic">Czech Republic</option>
                                    <option value="Hungary">Hungary</option>
                                    <option value="Slovakia">Slovakia</option>
                                    <option value="Slovenia">Slovenia</option>
                                    <option value="Croatia">Croatia</option>
                                    <option value="Estonia">Estonia</option>
                                    <option value="Latvia">Latvia</option>
                                    <option value="Lithuania">Lithuania</option>
                                    <option value="South Africa">South Africa</option>
                                    <option value="Nigeria">Nigeria</option>
                                    <option value="Kenya">Kenya</option>
                                    <option value="Ghana">Ghana</option>
                                    <option value="Egypt">Egypt</option>
                                    <option value="Morocco">Morocco</option>
                                    <option value="Tunisia">Tunisia</option>
                                    <option value="Algeria">Algeria</option>
                                    <option value="Ethiopia">Ethiopia</option>
                                    <option value="Tanzania">Tanzania</option>
                                    <option value="Uganda">Uganda</option>
                                    <option value="Rwanda">Rwanda</option>
                                    <option value="Zambia">Zambia</option>
                                    <option value="Zimbabwe">Zimbabwe</option>
                                    <option value="Botswana">Botswana</option>
                                    <option value="Namibia">Namibia</option>
                                    <option value="India">India</option>
                                    <option value="China">China</option>
                                    <option value="Japan">Japan</option>
                                    <option value="South Korea">South Korea</option>
                                    <option value="Singapore">Singapore</option>
                                    <option value="Malaysia">Malaysia</option>
                                    <option value="Thailand">Thailand</option>
                                    <option value="Philippines">Philippines</option>
                                    <option value="Indonesia">Indonesia</option>
                                    <option value="Vietnam">Vietnam</option>
                                    <option value="Taiwan">Taiwan</option>
                                    <option value="Hong Kong">Hong Kong</option>
                                    <option value="Brazil">Brazil</option>
                                    <option value="Mexico">Mexico</option>
                                    <option value="Argentina">Argentina</option>
                                    <option value="Chile">Chile</option>
                                    <option value="Colombia">Colombia</option>
                                    <option value="Peru">Peru</option>
                                    <option value="Uruguay">Uruguay</option>
                                    <option value="Ecuador">Ecuador</option>
                                    <option value="Venezuela">Venezuela</option>
                                    <option value="Costa Rica">Costa Rica</option>
                                    <option value="Panama">Panama</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-semibold text-brand-navy-600 text-lg">Industry Type</span>
                                </label>
                                <select id="industry-type" name="industry_type" required class="select select-bordered w-full text-lg input-focus bg-white border-2 border-blue-200 focus:border-brand-navy-500 focus:ring-2 focus:ring-blue-200">
                                    <option value="">Select industry</option>
                                    <option value="Construction">Construction</option>
                                    <option value="Manufacturing">Manufacturing</option>
                                    <option value="Agriculture">Agriculture</option>
                                    <option value="Hospitality">Hospitality & Tourism</option>
                                    <option value="Retail">Retail & Sales</option>
                                    <option value="Healthcare">Healthcare</option>
                                    <option value="Education">Education</option>
                                    <option value="Transportation">Transportation & Logistics</option>
                                    <option value="Food Service">Food Service</option>
                                    <option value="Cleaning">Cleaning & Maintenance</option>
                                    <option value="Security">Security Services</option>
                                    <option value="Event Management">Event Management</option>
                                    <option value="Technology">Technology</option>
                                    <option value="Finance">Finance & Accounting</option>
                                    <option value="Real Estate">Real Estate</option>
                                    <option value="Entertainment">Entertainment & Media</option>
                                    <option value="Non-Profit">Non-Profit</option>
                                    <option value="Government">Government</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-semibold text-brand-navy-600 text-lg">Expected Workers</span>
                                </label>
                                <select id="expected-workers" name="expected_workers" class="select select-bordered w-full text-lg input-focus bg-white border-2 border-blue-200 focus:border-brand-navy-500 focus:ring-2 focus:ring-blue-200">
                                    <option value="not_specified">Not specified</option>
                                    <option value="below_100">Below 100</option>
                                    <option value="100_250">100 - 250</option>
                                    <option value="251_500">251 - 500</option>
                                    <option value="501_1000">501 - 1000</option>
                                    <option value="above_1000">Above 1000</option>
                                </select>
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-semibold text-brand-navy-600 text-lg">Company Phone</span>
                                </label>
                                <input type="tel" id="company-phone" name="company_phone" placeholder="Enter company phone number" required 
                                       class="input input-bordered w-full text-lg input-focus bg-white border-2 border-blue-200 focus:border-brand-navy-500 focus:ring-2 focus:ring-blue-200">
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-semibold text-brand-navy-600 text-lg">Company Email</span>
                                </label>
                                <input type="email" id="company-email" name="company_email" placeholder="Enter company email address" required 
                                       class="input input-bordered w-full text-lg input-focus bg-white border-2 border-blue-200 focus:border-brand-navy-500 focus:ring-2 focus:ring-blue-200">
                            </div>

                            <button type="submit" id="create-btn" class="btn btn-primary w-full text-lg font-semibold btn-hover bg-gradient-to-r from-brand-navy-500 to-brand-navy-600 border-0 shadow-lg">
                                <span id="create-btn-text">
                                    <i class="fas fa-plus mr-3"></i>Create Workspace
                                </span>
                                <span id="create-btn-loading" class="hidden">
                                    <div class="loading-spinner inline-block mr-3"></div>Creating...
                                </span>
                            </button>
                        </form>
                        <div id="create-error" class="text-error text-center mt-4 hidden"></div>
                        <div id="create-warning" class="text-warning text-center mt-4 hidden"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Help Section -->
        <div class="text-center">
            <div class="card bg-white/60 backdrop-blur-sm shadow-lg border border-gray-200/50">
                <div class="card-body p-6">
                    <h3 class="text-2xl font-bold text-brand-navy-600 mb-4">Need Help?</h3>
                    <p class="text-brand-gray-600 mb-4">Our support team is here to help you get started</p>
                    <div class="flex flex-wrap justify-center gap-4">
                        <a href="mailto:support@embeeaccounting.com" class="btn btn-outline btn-sm">
                            <i class="fas fa-envelope mr-2"></i>Email Support
                        </a>
                        <a href="/terms-of-use" class="btn btn-outline btn-sm">
                            <i class="fas fa-file-contract mr-2"></i>Terms of Use
                        </a>
                        <a href="/privacy-policy" class="btn btn-outline btn-sm">
                            <i class="fas fa-shield-alt mr-2"></i>Privacy Policy
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailLink, isSignInWithEmailLink, sendSignInLinkToEmail } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDGpqXJZWQWl3lMYX-M_wOrSs2K6v7FNr0",
            authDomain: "casual-worker-manager.firebaseapp.com",
            projectId: "casual-worker-manager",
            storageBucket: "casual-worker-manager.firebasestorage.app",
            messagingSenderId: "671505306326",
            appId: "1:671505306326:web:0e64ba0b4b1e69aea79ed5"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // Store globally for use in other functions
        window.firebaseAuth = auth;
        window.signInWithEmailLink = signInWithEmailLink;
        window.isSignInWithEmailLink = isSignInWithEmailLink;
        window.sendSignInLinkToEmail = sendSignInLinkToEmail;
    </script>

    <script>
        // Utility functions
        function showLoading(buttonId, textId, loadingId) {
            document.getElementById(textId).classList.add('hidden');
            document.getElementById(loadingId).classList.remove('hidden');
            document.getElementById(buttonId).disabled = true;
        }

        function hideLoading(buttonId, textId, loadingId) {
            document.getElementById(textId).classList.remove('hidden');
            document.getElementById(loadingId).classList.add('hidden');
            document.getElementById(buttonId).disabled = false;
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
            setTimeout(() => {
                errorElement.classList.add('hidden');
            }, 5000);
        }

        function showGlobalMessage(type, message) {
            const element = document.getElementById(`global-${type}`);
            const messageElement = document.getElementById(`global-${type}-message`);
            messageElement.textContent = message;
            element.classList.remove('hidden');
            setTimeout(() => {
                element.classList.add('hidden');
            }, 5000);
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validatePhone(phone) {
            const cleanPhone = phone.replace(/[\s\-\(\)]/g, '');
            return /^[\+]?[1-9][\d]{0,15}$/.test(cleanPhone);
        }

        // Auto-uppercase workspace code input
        document.getElementById('workspace-code').addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        });

        // Join workspace form submission
        document.getElementById('join-workspace-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const workspaceCode = document.getElementById('workspace-code').value.trim();
            
            if (!workspaceCode) {
                showError('join-error', 'Please enter a workspace code');
                return;
            }
            
            if (workspaceCode.length !== 16) {
                showError('join-error', 'Workspace code must be exactly 16 characters');
                return;
            }

            showLoading('join-btn', 'join-btn-text', 'join-btn-loading');

            try {
                const response = await fetch('/api/workspace/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        workspace_code: workspaceCode
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    showGlobalMessage('success', `Found workspace "${data.workspace.name}"! Proceeding to sign in...`);
                    
                    // Store workspace data for later use
                    localStorage.setItem('pendingWorkspace', JSON.stringify(data.workspace));
                    
                    // Redirect to sign-in
                    setTimeout(() => {
                        window.location.href = '/signin';
                    }, 1500);
                } else {
                    throw new Error(data.error || 'Failed to join workspace');
                }
            } catch (error) {
                console.error('Error joining workspace:', error);
                showError('join-error', error.message || 'Failed to join workspace. Please try again.');
            } finally {
                hideLoading('join-btn', 'join-btn-text', 'join-btn-loading');
            }
        });

        // Create workspace form submission
        document.getElementById('create-workspace-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Collect form data
            const formData = {
                company_name: document.getElementById('company-name').value.trim(),
                country: document.getElementById('country').value,
                industry_type: document.getElementById('industry-type').value,
                expected_workers: document.getElementById('expected-workers').value,
                company_phone: document.getElementById('company-phone').value.trim(),
                company_email: document.getElementById('company-email').value.trim()
            };

            // Validation
            if (!formData.company_name || formData.company_name.length < 2) {
                showError('create-error', 'Company name must be at least 2 characters');
                return;
            }

            if (!formData.country) {
                showError('create-error', 'Please select a country');
                return;
            }

            if (!formData.industry_type) {
                showError('create-error', 'Please select an industry type');
                return;
            }

            if (!formData.company_phone) {
                showError('create-error', 'Please enter a company phone number');
                return;
            }

            if (!validatePhone(formData.company_phone)) {
                showError('create-error', 'Please enter a valid phone number');
                return;
            }

            if (!formData.company_email) {
                showError('create-error', 'Please enter a company email address');
                return;
            }

            if (!validateEmail(formData.company_email)) {
                showError('create-error', 'Please enter a valid email address');
                return;
            }

            showLoading('create-btn', 'create-btn-text', 'create-btn-loading');

            try {
                const response = await fetch('/api/workspace/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    if (data.warning) {
                        document.getElementById('create-warning').textContent = data.warning;
                        document.getElementById('create-warning').classList.remove('hidden');
                    }
                    
                    showGlobalMessage('success', `Workspace "${data.workspace.name}" prepared! Proceeding to sign in...`);
                    
                    // Store workspace data for later use
                    localStorage.setItem('pendingWorkspace', JSON.stringify(data.workspace));
                    
                    // Redirect to sign-in
                    setTimeout(() => {
                        window.location.href = '/signin';
                    }, 1500);
                } else {
                    throw new Error(data.error || 'Failed to create workspace');
                }
            } catch (error) {
                console.error('Error creating workspace:', error);
                showError('create-error', error.message || 'Failed to create workspace. Please try again.');
            } finally {
                hideLoading('create-btn', 'create-btn-text', 'create-btn-loading');
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Clear any stored workspace data on page load
            localStorage.removeItem('pendingWorkspace');
            
            // Focus on first input
            document.getElementById('workspace-code').focus();
        });
    </script>
</body>
</html>
